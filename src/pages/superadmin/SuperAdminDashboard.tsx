/**
 * üöÄ Modern SuperAdmin Dashboard
 * SolarVeyo Platform Y√∂netimi
 */

import React, { useState, useEffect } from 'react';
import { useAuth } from '../../contexts/AuthContext';
import { 
  getAllCompaniesWithStats, 
  getPlatformStats, 
  updateCompanySubscription,
  toggleCompanyStatus,
  deleteCompany,
  getAdminActivityLogs,
  secureDeleteCompany,
  type CompanyStats,
  type PlatformStats,
  type AdminActivityLog
} from '../../services/superAdminService';
import { deleteCompanyCompletely } from '../../services/companyDeletionService';
import { collection, getDocs, query, where } from 'firebase/firestore';
import { db } from '../../lib/firebase';
import { cleanupOdemeDurumuFields } from '../../utils/cleanupOdemeDurumu';
import { SAAS_CONFIG } from '../../config/saas.config';
import { getMergedPlans, subscribeToMergedPlans } from '../../services/planConfigService';
import { 
  Card, 
  CardContent, 
  CardHeader, 
  CardTitle,
  Button,
  Badge,
  Select,
  LoadingSpinner,
  Modal
} from '../../components/ui';
import { 
  Building2, 
  Users, 
  DollarSign, 
  TrendingUp, 
  Calendar,
  AlertTriangle,
  CheckCircle,
  XCircle,
  Crown,
  Activity,
  Eye,
  Zap,
  Wrench
} from 'lucide-react';
import toast from 'react-hot-toast';

const SuperAdminDashboard: React.FC = () => {
  const { userProfile } = useAuth();
  const [loading, setLoading] = useState(true);
  const [companies, setCompanies] = useState<CompanyStats[]>([]);
  const [platformStats, setPlatformStats] = useState<PlatformStats | null>(null);
  const [activityLogs, setActivityLogs] = useState<AdminActivityLog[]>([]);
  const [selectedCompany, setSelectedCompany] = useState<CompanyStats | null>(null);
  const [showSubscriptionModal, setShowSubscriptionModal] = useState(false);
  const [showCompanyDetailModal, setShowCompanyDetailModal] = useState(false);
  const [newPlanId, setNewPlanId] = useState('');
  const [plans, setPlans] = useState<Record<string, any>>(() => (SAAS_CONFIG as any).PLANS);
  const [showSecureDeleteModal, setShowSecureDeleteModal] = useState(false);
  const [confirmCompanyName, setConfirmCompanyName] = useState('');
  const [deleteBusy, setDeleteBusy] = useState(false);
  const [showOrphanCleanup, setShowOrphanCleanup] = useState(false);
  const [orphanCompanyName, setOrphanCompanyName] = useState('');
  const [orphanFoundId, setOrphanFoundId] = useState<string>('');
  const [orphanBusy, setOrphanBusy] = useState(false);

  // Yetki kontrol√º
  if (!userProfile || userProfile.rol !== 'superadmin') {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-96">
          <CardHeader>
            <CardTitle className="text-red-600 flex items-center gap-2">
              <XCircle className="h-5 w-5" />
              Yetkisiz Eri≈üim
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-gray-600">Bu sayfa sadece SuperAdmin kullanƒ±cƒ±larƒ± i√ßin.</p>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Verileri y√ºkle
  const loadData = async () => {
    try {
      setLoading(true);
      const [companiesData, statsData, logsData] = await Promise.all([
        getAllCompaniesWithStats(),
        getPlatformStats(),
        getAdminActivityLogs(20)
      ]);
      
      setCompanies(companiesData);
      setPlatformStats(statsData);
      setActivityLogs(logsData);
    } catch (error) {
      console.error('Veri y√ºkleme hatasƒ±:', error);
      toast.error('Veriler y√ºklenirken hata olu≈ütu');
    } finally {
      setLoading(false);
    }
  };

  // Planlarƒ± y√ºkle ve canlƒ± dinle ‚Äì SuperAdmin planlarƒ± g√ºncellediƒüinde dropdown anƒ±nda g√ºncellensin
  useEffect(() => {
    let unsubscribe: (() => void) | undefined;
    (async () => {
      try {
        const merged = await getMergedPlans();
        setPlans(merged);
      } catch {}
      unsubscribe = subscribeToMergedPlans((merged) => setPlans(merged));
    })();
    return () => {
      if (unsubscribe) unsubscribe();
    };
  }, []);

  useEffect(() => {
    loadData();
  }, []);

  // Abonelik g√ºncelle
  const handleUpdateSubscription = async () => {
    if (!selectedCompany || !newPlanId) return;
    
    try {
      await updateCompanySubscription(
        selectedCompany.id, 
        newPlanId, 
        userProfile!.id, 
        userProfile!.ad
      );
      
      toast.success('Abonelik ba≈üarƒ±yla g√ºncellendi');
      setShowSubscriptionModal(false);
      loadData();
    } catch (error) {
      console.error('Abonelik g√ºncelleme hatasƒ±:', error);
      toast.error('Abonelik g√ºncellenirken hata olu≈ütu');
    }
  };

  // Silinmi≈ü (companies'de g√∂r√ºnmeyen) ≈üirketler i√ßin: adƒ±yla ID bul ve temizle
  const findDeletedCompanyIdByName = async (name: string) => {
    const q = query(
      collection(db, 'adminActivityLogs'),
      where('action', '==', 'company_delete')
    );
    const snap = await getDocs(q);
    const items = snap.docs
      .map(d=>d.data() as any)
      .filter(d => String(d.targetCompanyName || '').trim().toLowerCase() === String(name||'').trim().toLowerCase())
      .sort((a,b)=> (b.timestamp?.seconds||0) - (a.timestamp?.seconds||0));
    return items[0]?.targetCompanyId || '';
  };

  const handleOrphanCleanup = async () => {
    if (!orphanCompanyName) { toast.error('≈ûirket adƒ±nƒ± yazƒ±n'); return; }
    try {
      setOrphanBusy(true);
      const id = await findDeletedCompanyIdByName(orphanCompanyName);
      setOrphanFoundId(id);
      if (!id) { toast.error('Kayƒ±tlarda bu adla silinmi≈ü ≈üirket bulunamadƒ±'); return; }
      const res = await deleteCompanyCompletely(id, { userId: userProfile!.id, userEmail: userProfile!.email || '', userName: userProfile!.ad });
      if (res.success) {
        toast.success('Yetim veriler temizlendi');
        setOrphanCompanyName(''); setOrphanFoundId(''); setShowOrphanCleanup(false);
        loadData();
      } else {
        toast(res.errors.length ? res.errors[0] : 'Temizlikte hata');
      }
    } catch (e) {
      console.error(e);
      toast.error('Temizlik hatasƒ±');
    } finally {
      setOrphanBusy(false);
    }
  };

  // ≈ûirket durumu deƒüi≈ütir
  const handleToggleCompany = async (company: CompanyStats) => {
    try {
      await toggleCompanyStatus(
        company.id, 
        company.isActive, 
        userProfile!.id, 
        userProfile!.ad
      );
      
      toast.success(`≈ûirket ${!company.isActive ? 'aktifle≈ütirildi' : 'pasifle≈ütirildi'}`);
      loadData();
    } catch (error) {
      console.error('≈ûirket durumu deƒüi≈ütirme hatasƒ±:', error);
      toast.error('ƒ∞≈ülem ba≈üarƒ±sƒ±z');
    }
  };

  // ≈ûirket sil
  const handleDeleteCompany = async (company: CompanyStats) => {
    setSelectedCompany(company);
    setConfirmCompanyName('');
    setShowSecureDeleteModal(true);
  };

  const handleSecureDelete = async () => {
    if (!selectedCompany) return;
    const norm = (s: string) => String(s||'').trim().toLowerCase();
    if (norm(confirmCompanyName) !== norm(selectedCompany.name)) {
      toast.error('Onay metni ≈üirket adƒ±yla e≈üle≈ümiyor');
      return;
    }
    try {
      setDeleteBusy(true);
      const { summary, result } = await secureDeleteCompany({
        companyId: selectedCompany.id,
        adminId: userProfile!.id,
        adminName: userProfile!.ad,
        confirmCompanyName: confirmCompanyName
      });
      toast.success('≈ûirket ve baƒülƒ± veriler silindi');
      setShowSecureDeleteModal(false);
      setSelectedCompany(null);
      loadData();
      // Konsola √∂zet bƒ±rak
      console.log('Silme √ñzeti:', summary);
      console.log('Silme Sonucu:', result);
    } catch (error) {
      console.error('G√ºvenli silme hatasƒ±:', error);
      toast.error('Silme ba≈üarƒ±sƒ±z');
    } finally {
      setDeleteBusy(false);
    }
  };

  // Durum badge'i - Daha detaylƒ± g√∂sterim
  const getStatusBadge = (status: string, daysRemaining: number) => {
    // Eƒüer g√ºn negatifse veya 0 ise expired olarak g√∂ster
    if (daysRemaining <= 0) {
      return (
        <Badge variant="danger">
          ‚ö†Ô∏è S√ºresi Dolmu≈ü
        </Badge>
      );
    }
    
    switch (status) {
      case 'trial':
        return (
          <Badge variant={daysRemaining > 3 ? 'info' : 'warning'}>
            üéÅ Deneme ({daysRemaining} g√ºn)
          </Badge>
        );
      case 'active':
        return (
          <Badge variant={daysRemaining > 7 ? 'success' : 'warning'}>
            ‚úÖ Aktif ({daysRemaining} g√ºn)
          </Badge>
        );
      case 'expired':
        return <Badge variant="danger">‚ùå S√ºresi Dolmu≈ü</Badge>;
      case 'lifetime':
        return <Badge variant="success">‚ôæÔ∏è √ñm√ºr Boyu</Badge>;
      default:
        return <Badge variant="secondary">Bilinmiyor</Badge>;
    }
  };

  // Format para
  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('tr-TR', {
      style: 'currency',
      currency: 'TRY'
    }).format(amount);
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <LoadingSpinner />
      </div>
    );
  }

  return (
    <div className="space-y-6 p-6">
      {/* Header */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-2">
            <Crown className="h-8 w-8 text-yellow-500" />
            SuperAdmin Dashboard
          </h1>
          <p className="text-gray-600 mt-1">SolarVeyo Platform Y√∂netimi</p>
        </div>
        <div className="flex gap-2">
          <Button 
            onClick={async () => {
              const confirmed = window.confirm('Eski √∂deme durumu alanlarƒ±nƒ± temizlemek istediƒüinize emin misiniz?');
              if (confirmed) {
                try {
                  const count = await cleanupOdemeDurumuFields();
                  toast.success(`${count} kullanƒ±cƒ± temizlendi!`);
                  loadData();
                } catch (error) {
                  toast.error('Temizlik sƒ±rasƒ±nda hata olu≈ütu');
                }
              }
            }}
            variant="outline"
            className="flex items-center gap-2 bg-orange-50 hover:bg-orange-100 text-orange-700"
          >
            <Wrench className="h-4 w-4" />
            Eski Alanlarƒ± Temizle
          </Button>
          <Button 
            onClick={loadData}
            variant="outline"
            className="flex items-center gap-2"
          >
            <Activity className="h-4 w-4" />
            Yenile
          </Button>
        </div>
      </div>

      {/* Platform ƒ∞statistikleri */}
      {platformStats && (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-gray-600">Toplam ≈ûirket</p>
                  <p className="text-2xl font-bold text-gray-900">{platformStats.totalCompanies}</p>
                </div>
                <Building2 className="h-8 w-8 text-blue-500" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-gray-600">Aktif ≈ûirket</p>
                  <p className="text-2xl font-bold text-green-600">{platformStats.activeCompanies}</p>
                </div>
                <CheckCircle className="h-8 w-8 text-green-500" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-gray-600">Aylƒ±k Gelir</p>
                  <p className="text-2xl font-bold text-green-600">{formatCurrency(platformStats.monthlyRevenue)}</p>
                </div>
                <DollarSign className="h-8 w-8 text-green-500" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-gray-600">Son 7 G√ºn Kayƒ±t</p>
                  <p className="text-2xl font-bold text-blue-600">{platformStats.recentSignups}</p>
                </div>
                <TrendingUp className="h-8 w-8 text-blue-500" />
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* ≈ûirket Listesi */}
      <Card>
        <CardHeader>
          <CardTitle>≈ûirketler ({companies.length})</CardTitle>
        </CardHeader>
        <CardContent>
          {/* Yetim Temizlik (Ad ile) */}
          <div className="mb-4 p-3 border rounded bg-yellow-50">
            <div className="flex flex-col sm:flex-row gap-2 items-start sm:items-end">
              <div className="flex-1 w-full">
                <label className="text-sm text-gray-700">Silinmi≈ü ≈üirket adƒ± (admin loglarƒ±ndan ID bulunur)</label>
                <input className="w-full border rounded px-3 py-2 text-sm" placeholder="√ñrn: ABC ≈ûƒ∞RKETƒ∞" value={orphanCompanyName} onChange={(e)=>setOrphanCompanyName(e.target.value)} />
              </div>
              <Button onClick={handleOrphanCleanup} disabled={orphanBusy || !orphanCompanyName}>{orphanBusy?'√áalƒ±≈üƒ±yor...':'Bul & Temizle'}</Button>
            </div>
            {orphanFoundId && (
              <div className="mt-2 text-xs text-gray-600">Bulunan ID: <span className="font-mono">{orphanFoundId}</span></div>
            )}
          </div>
          <div className="space-y-4">
            {companies.map((company) => (
              <div 
                key={company.id}
                className="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <div className="flex items-center justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h3 className="font-semibold text-lg">{company.name}</h3>
                      {getStatusBadge(company.subscriptionStatus, company.daysRemaining)}
                      {!company.isActive && (
                        <Badge variant="danger">Pasif</Badge>
                      )}
                    </div>
                    
                    <div className="grid grid-cols-2 md:grid-cols-6 gap-4 text-sm text-gray-600">
                      <div>Plan: <span className="font-medium">{company.planDisplayName}</span></div>
                      <div>Fiyat: <span className="font-medium">{formatCurrency(company.subscriptionPrice)}</span></div>
                      <div>Kullanƒ±cƒ±: <span className="font-medium">{company.userCount}</span></div>
                      <div>Saha: <span className="font-medium">{company.sahaCount}</span></div>
                      <div>Santral: <span className="font-medium">{company.santralCount}</span></div>
                      <div>Arƒ±za: <span className="font-medium text-red-600">{company.arizaCount}</span></div>
                    </div>
                    
                    <div className="mt-2 grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500">
                      <div>Bu ay arƒ±za: <span className="font-medium">{company.monthlyStats.arizalar}</span></div>
                      <div>Bu ay bakƒ±m: <span className="font-medium">{company.monthlyStats.bakimlar}</span></div>
                      <div>Depolama: <span className="font-medium">{company.storageUsed.toFixed(2)}MB / {company.storageLimit}MB</span></div>
                      <div>Toplam bakƒ±m: <span className="font-medium">{company.bakimCount}</span></div>
                    </div>
                    
                    <div className="mt-2 text-xs text-gray-500">
                      Kayƒ±t: {company.createdAt.toLocaleDateString('tr-TR')}
                      {company.email && ` ‚Ä¢ ${company.email}`}
                    </div>
                  </div>
                  
                  <div className="flex items-center gap-2 ml-4">
                    <Button 
                      size="sm"
                      variant="secondary"
                      onClick={() => {
                        setSelectedCompany(company);
                        setShowCompanyDetailModal(true);
                      }}
                    >
                      Detaylar
                    </Button>
                    
                    <Button 
                      size="sm"
                      variant="outline"
                      onClick={() => {
                        setSelectedCompany(company);
                        setNewPlanId(company.subscriptionPlan);
                        setShowSubscriptionModal(true);
                      }}
                    >
                      Plan Deƒüi≈ütir
                    </Button>
                    
                    <Button 
                      size="sm"
                      variant={company.isActive ? 'outline' : 'primary'}
                      onClick={() => handleToggleCompany(company)}
                    >
                      {company.isActive ? 'Pasifle≈ütir' : 'Aktifle≈ütir'}
                    </Button>
                    
                    <Button 
                      size="sm"
                      variant="danger"
                      onClick={() => handleDeleteCompany(company)}
                    >
                      G√ºvenli Sil
                    </Button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Activity Logs */}
      <Card>
        <CardHeader>
          <CardTitle>Son Aktiviteler</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {activityLogs.map((log) => (
              <div key={log.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                <div>
                  <p className="font-medium">{log.details}</p>
                  <p className="text-sm text-gray-600">
                    {log.adminName} ‚Ä¢ {log.targetCompanyName || 'Platform'}
                  </p>
                </div>
                <span className="text-xs text-gray-500">
                  {log.timestamp.toLocaleDateString('tr-TR')} {log.timestamp.toLocaleTimeString('tr-TR')}
                </span>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Abonelik Deƒüi≈ütirme Modal */}
      <Modal 
        isOpen={showSubscriptionModal} 
        onClose={() => setShowSubscriptionModal(false)}
        title="Abonelik Planƒ± Deƒüi≈ütir"
      >
        {selectedCompany && (
          <div className="space-y-4">
            <div>
              <h3 className="font-semibold">{selectedCompany.name}</h3>
              <div className="flex items-center gap-3 mt-1">
                <p className="text-sm text-gray-600">Mevcut plan: {selectedCompany.planDisplayName}</p>
                {getStatusBadge(selectedCompany.subscriptionStatus, selectedCompany.daysRemaining)}
              </div>
            </div>
            
            {/* Uyarƒ± mesajƒ± - deneme s√ºresi dolmu≈ü kullanƒ±cƒ±lar i√ßin */}
            {selectedCompany.daysRemaining <= 0 && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                <p className="text-sm text-red-700">
                  ‚ö†Ô∏è Bu ≈üirketin abonelik s√ºresi dolmu≈ü. Yeni plan atayarak aktif hale getirebilirsiniz.
                </p>
              </div>
            )}
            
            <div>
              <label className="block text-sm font-medium mb-2">Yeni Plan</label>
              <Select
                value={newPlanId}
                onChange={(e) => setNewPlanId(e.target.value)}
                options={[
                  { value: '', label: 'Plan Se√ßin...' },
                  ...Object.values(plans)
                    .filter((p: any) => p.id !== 'trial')
                    .map((plan: any) => ({
                      value: plan.id,
                      label: `${plan.displayName} - ${formatCurrency(plan.price)}/ay`
                    }))
                ]}
              />
            </div>
            
            {/* Plan se√ßildiƒüinde bilgi g√∂ster */}
            {newPlanId && newPlanId !== selectedCompany.subscriptionPlan && (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                <p className="text-sm text-blue-700">
                  ‚úÖ Plan deƒüi≈ütirildiƒüinde:
                  <ul className="mt-1 ml-4 list-disc">
                    <li>Abonelik durumu "Aktif" olacak</li>
                    <li>1 aylƒ±k s√ºre tanƒ±mlanacak</li>
                    <li>Deneme s√ºresi bilgileri temizlenecek</li>
                  </ul>
                </p>
              </div>
            )}
            
            <div className="flex justify-end gap-2 pt-4">
              <Button 
                variant="outline" 
                onClick={() => setShowSubscriptionModal(false)}
              >
                ƒ∞ptal
              </Button>
              <Button 
                onClick={handleUpdateSubscription}
                disabled={!newPlanId || newPlanId === selectedCompany.subscriptionPlan}
              >
                G√ºncelle
              </Button>
            </div>
          </div>
        )}
      </Modal>

      {/* ≈ûirket Detay Modalƒ± */}
      <Modal 
        isOpen={showCompanyDetailModal} 
        onClose={() => setShowCompanyDetailModal(false)}
        title="≈ûirket Detaylarƒ±"
      >
        {selectedCompany && (
          <div className="space-y-6">
            {/* Genel Bilgiler */}
            <div className="bg-gray-50 rounded-lg p-4">
              <h3 className="font-semibold text-lg mb-3 flex items-center gap-2">
                <Building2 className="h-5 w-5" />
                {selectedCompany.name}
              </h3>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                <div>Email: <span className="font-medium">{selectedCompany.email}</span></div>
                <div>Telefon: <span className="font-medium">{selectedCompany.phone || 'Belirtilmemi≈ü'}</span></div>
                <div>Kayƒ±t Tarihi: <span className="font-medium">{selectedCompany.createdAt.toLocaleDateString('tr-TR')}</span></div>
                <div>Durum: {getStatusBadge(selectedCompany.subscriptionStatus, selectedCompany.daysRemaining)}</div>
              </div>
            </div>

            {/* Bu Ay ƒ∞statistikleri */}
            <div>
              <h4 className="font-semibold mb-3 flex items-center gap-2">
                <TrendingUp className="h-4 w-4" />
                Bu Ay ƒ∞statistikleri
              </h4>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div className="bg-red-50 p-3 rounded-lg text-center">
                  <div className="text-2xl font-bold text-red-600">{selectedCompany.monthlyStats.arizalar}</div>
                  <div className="text-sm text-red-700">Yeni Arƒ±za</div>
                </div>
                <div className="bg-blue-50 p-3 rounded-lg text-center">
                  <div className="text-2xl font-bold text-blue-600">{selectedCompany.monthlyStats.bakimlar}</div>
                  <div className="text-sm text-blue-700">Yapƒ±lan Bakƒ±m</div>
                </div>
                <div className="bg-green-50 p-3 rounded-lg text-center">
                  <div className="text-2xl font-bold text-green-600">{selectedCompany.monthlyStats.yeniKullanicilar}</div>
                  <div className="text-sm text-green-700">Aktif Kullanƒ±cƒ±</div>
                </div>
              </div>
            </div>

            {/* Genel ƒ∞statistikler */}
            <div>
              <h4 className="font-semibold mb-3">Genel ƒ∞statistikler</h4>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="bg-white border rounded-lg p-3 text-center">
                  <div className="text-xl font-bold text-gray-900">{selectedCompany.arizaCount}</div>
                  <div className="text-sm text-gray-600 flex items-center justify-center gap-1">
                    <AlertTriangle className="h-3 w-3" />
                    Toplam Arƒ±za
                  </div>
                </div>
                <div className="bg-white border rounded-lg p-3 text-center">
                  <div className="text-xl font-bold text-gray-900">{selectedCompany.bakimCount}</div>
                  <div className="text-sm text-gray-600 flex items-center justify-center gap-1">
                    <Wrench className="h-3 w-3" />
                    Toplam Bakƒ±m
                  </div>
                </div>
                <div className="bg-white border rounded-lg p-3 text-center">
                  <div className="text-xl font-bold text-gray-900">{selectedCompany.sahaCount}</div>
                  <div className="text-sm text-gray-600 flex items-center justify-center gap-1">
                    <Building2 className="h-3 w-3" />
                    Saha Sayƒ±sƒ±
                  </div>
                </div>
                <div className="bg-white border rounded-lg p-3 text-center">
                  <div className="text-xl font-bold text-gray-900">{selectedCompany.santralCount}</div>
                  <div className="text-sm text-gray-600 flex items-center justify-center gap-1">
                    <Zap className="h-3 w-3" />
                    Santral Sayƒ±sƒ±
                  </div>
                </div>
              </div>
            </div>

            {/* Kullanƒ±cƒ± Listesi */}
            <div>
              <h4 className="font-semibold mb-3 flex items-center gap-2">
                <Users className="h-4 w-4" />
                Kullanƒ±cƒ±lar ({selectedCompany.users.length})
              </h4>
              <div className="max-h-40 overflow-y-auto space-y-2">
                {selectedCompany.users.map((user) => (
                  <div key={user.id} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <div>
                      <span className="font-medium">{user.ad}</span>
                      <span className="text-sm text-gray-600 ml-2">({user.rol})</span>
                    </div>
                    <div className="text-xs text-gray-500">
                      {user.email}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Saha Listesi */}
            <div>
              <h4 className="font-semibold mb-3 flex items-center gap-2">
                <Building2 className="h-4 w-4" />
                Sahalar ({selectedCompany.sahalar.length})
              </h4>
              <div className="max-h-40 overflow-y-auto space-y-2">
                {selectedCompany.sahalar.map((saha) => (
                  <div key={saha.id} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <div>
                      <span className="font-medium">{saha.ad}</span>
                      <span className="text-sm text-gray-600 ml-2">({saha.musteriAdi})</span>
                    </div>
                    <div className="text-xs text-gray-500">
                      {saha.santralSayisi} santral
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="flex justify-end pt-4">
              <Button 
                variant="outline" 
                onClick={() => setShowCompanyDetailModal(false)}
              >
                Kapat
              </Button>
            </div>
          </div>
        )}
      </Modal>

      {/* G√ºvenli Silme Modalƒ± */}
      <Modal
        isOpen={showSecureDeleteModal}
        onClose={() => setShowSecureDeleteModal(false)}
        title="≈ûirketi G√ºvenli Sil"
      >
        {selectedCompany && (
          <div className="space-y-4">
            <div className="text-sm text-gray-700">
              L√ºtfen onay i√ßin ≈üirket adƒ±nƒ± aynen yazƒ±n: <span className="font-semibold">{selectedCompany.name}</span>
            </div>
            <input
              className="w-full border rounded px-3 py-2 text-sm"
              placeholder={selectedCompany.name}
              value={confirmCompanyName}
              onChange={(e)=>setConfirmCompanyName(e.target.value)}
            />
            <div className="flex justify-end gap-2">
              <Button variant="outline" onClick={()=>setShowSecureDeleteModal(false)}>ƒ∞ptal</Button>
              <Button onClick={handleSecureDelete} disabled={deleteBusy || !confirmCompanyName}>
                {deleteBusy ? 'Siliniyor...' : 'Kalƒ±cƒ± Olarak Sil'}
              </Button>
            </div>
            <div className="text-xs text-red-600">
              Bu i≈ülem geri alƒ±namaz. T√ºm ≈üirket verileri (kullanƒ±cƒ±lar, arƒ±zalar, bakƒ±mlar, bildirimler, storage yedekleri vb.) silinecek.
            </div>
          </div>
        )}
      </Modal>
    </div>
  );
};

export default SuperAdminDashboard;